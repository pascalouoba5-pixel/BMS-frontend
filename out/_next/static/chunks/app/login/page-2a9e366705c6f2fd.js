(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{150:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var s=r(73365),o=r(59534),a=r.n(o);function n(e){let{className:t="",variant:r="default",size:o="md"}=e,n="".concat("inline-flex items-center gap-2 font-medium transition-all duration-200 hover:scale-105"," ").concat({default:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow-sm hover:shadow-md",outline:"border-2 border-blue-600 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-600 hover:text-white",icon:"bg-blue-100 text-blue-600 p-2 rounded-lg hover:bg-blue-200"}[r]," ").concat({sm:"text-sm px-3 py-1.5",md:"text-base px-4 py-2",lg:"text-lg px-6 py-3"}[o]," ").concat(t);return(0,s.jsxs)(a(),{href:"/",className:n,children:[(0,s.jsx)("i",{className:"ri-home-line"}),"icon"!==r&&(0,s.jsx)("span",{children:"Accueil"})]})}},21332:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(1521);let o=()=>{let[e,t]=(0,s.useState)({token:null,user:null,isAuthenticated:!1,userRole:null});(0,s.useEffect)(()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("user");if(e&&r){let s=JSON.parse(r);t({token:e,user:s,isAuthenticated:!0,userRole:s.role||null})}},[]);let r=(0,s.useCallback)((e,r)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(r)),t({token:e,user:r,isAuthenticated:!0,userRole:r.role||null})},[]),o=(0,s.useCallback)(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t({token:null,user:null,isAuthenticated:!1,userRole:null})},[]),a=(0,s.useCallback)(e=>{localStorage.setItem("token",e),t(t=>({...t,token:e}))},[]);return{...e,login:r,logout:o,updateToken:a}}},29519:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(73365),o=r(1521),a=r(50627),n=r(59534),c=r.n(n),i=r(63925),l=r(150),d=r(21332);function u(){let[e,t]=(0,o.useState)({email:"",password:""}),[r,n]=(0,o.useState)(!1),[u,g]=(0,o.useState)(""),[m,h]=(0,o.useState)(!1),p=(0,a.useRouter)(),{login:x}=(0,d.A)(),f=e=>{t(t=>({...t,[e.target.name]:e.target.value})),g("")},v=async t=>{t.preventDefault(),n(!0),g(""),console.log("\uD83D\uDD10 [Login] Tentative de connexion..."),console.log("\uD83D\uDCE7 [Login] Email: ".concat(e.email));try{var r,s;console.log("\uD83D\uDCE1 [Login] Appel API de connexion...");let t=await i.R2.login({email:e.email,password:e.password});if(console.log("✅ [Login] R\xe9ponse API re\xe7ue:",{user:null==(r=t.user)?void 0:r.email,role:null==(s=t.user)?void 0:s.role,hasToken:!!t.token}),!t.token)throw Error("Aucun token re\xe7u de l'API");console.log("\uD83D\uDD10 [Login] Appel du hook useAuth.login..."),x(t.user,t.token),console.log("✅ [Login] Connexion r\xe9ussie, redirection..."),p.push("/")}catch(t){console.error("❌ [Login] Erreur lors de la connexion:",t);let e="Erreur lors de la connexion";t.message&&(e=t.message.includes("Token invalide")?"Erreur d'authentification - Veuillez vous reconnecter":t.message.includes("401")?"Email ou mot de passe incorrect":t.message.includes("NetworkError")?"Erreur de connexion au serveur":t.message),g(e)}finally{n(!1)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"absolute top-4 left-4",children:(0,s.jsx)(l.default,{variant:"outline",size:"sm"})}),(0,s.jsx)("div",{className:"container",children:(0,s.jsxs)("form",{className:"login-box",onSubmit:v,children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("img",{src:"https://static.readdy.ai/image/36ce116ccdb0d05752a287dd792317ce/3a2cd734c9129790560cc32a9975e166.jfif",alt:"BMS Logo",className:"h-12 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Connexion BMS"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Acc\xe9dez \xe0 votre espace de gestion"})]}),u&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:u}),(0,s.jsxs)("div",{className:"input-box",children:[(0,s.jsx)("input",{type:"email",name:"email",value:e.email,onChange:f,required:!0,className:"w-full"}),(0,s.jsx)("label",{children:"Email"})]}),(0,s.jsxs)("div",{className:"input-box password-input",children:[(0,s.jsx)("input",{type:m?"text":"password",name:"password",value:e.password,onChange:f,required:!0,className:"w-full pr-12"}),(0,s.jsx)("label",{children:"Mot de passe"}),(0,s.jsx)("button",{type:"button",onClick:()=>{h(!m)},className:"password-toggle-btn","aria-label":m?"Masquer le mot de passe":"Afficher le mot de passe",children:m?(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):(0,s.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),(0,s.jsx)("div",{className:"forgot-pass",children:(0,s.jsx)(c(),{href:"/forgot-password",className:"text-blue-600 hover:text-blue-800 transition-colors",children:"Mot de passe oubli\xe9 ?"})}),(0,s.jsx)("button",{type:"submit",className:"btn w-full ".concat(r?"opacity-75 cursor-not-allowed":""),disabled:r,children:r?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Connexion..."]}):"Se connecter"}),(0,s.jsxs)("div",{className:"signup-link",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Pas encore de compte ? "}),(0,s.jsx)(c(),{href:"/gestion-comptes",className:"text-blue-600 hover:text-blue-800 font-medium transition-colors",children:"G\xe9rer les comptes"})]}),(0,s.jsxs)("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Comptes de test :"}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Admin:"})," test@bms.com / test123"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Integration:"})," integration@bms.com / integration123"]})]})]})]})})]})}r(34007)},34007:()=>{},42608:(e,t,r)=>{Promise.resolve().then(r.bind(r,29519))},63925:(e,t,r)=>{"use strict";r.d(t,{H2:()=>u,R2:()=>g,sF:()=>m,dR:()=>h,c9:()=>p});var s=function(e){return e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.CRITICAL="CRITICAL",e}({});class o{formatMessage(e){let t=new Date(e.timestamp).toLocaleTimeString(),r=e.context?"[".concat(e.context,"]"):"",s="[".concat(e.level,"]"),o="".concat(t," ").concat(s," ").concat(r," ").concat(e.message);return e.data&&(o+=" | Data: ".concat(JSON.stringify(e.data))),e.error&&(o+=" | Error: ".concat(e.error.message),e.error.stack&&(o+=" | Stack: ".concat(e.error.stack))),o}addLog(e){if(this.logs.push(e),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.isDevelopment){let t=this.formatMessage(e);switch(e.level){case"DEBUG":console.debug(t);break;case"INFO":console.info(t);break;case"WARN":console.warn(t);break;case"ERROR":case"CRITICAL":console.error(t)}}!this.isDevelopment&&e.level>="ERROR"&&this.sendToMonitoring(e)}async sendToMonitoring(e){try{{let t=JSON.parse(localStorage.getItem("bms_monitoring_logs")||"[]");t.push(e),localStorage.setItem("bms_monitoring_logs",JSON.stringify(t.slice(-100)))}}catch(e){console.error("Erreur lors de l'envoi au monitoring:",e)}}debug(e,t,r){this.addLog({level:"DEBUG",message:e,context:t,data:r,timestamp:new Date().toISOString()})}info(e,t,r){this.addLog({level:"INFO",message:e,context:t,data:r,timestamp:new Date().toISOString()})}warn(e,t,r){this.addLog({level:"WARN",message:e,context:t,data:r,timestamp:new Date().toISOString()})}error(e,t,r,s){this.addLog({level:"ERROR",message:e,error:t,context:r,data:s,timestamp:new Date().toISOString()})}critical(e,t,r,s){this.addLog({level:"CRITICAL",message:e,error:t,context:r,data:s,timestamp:new Date().toISOString()})}apiError(e,t,r,s){this.error("Erreur API sur ".concat(e),t,"API",{endpoint:e,status:null==r?void 0:r.status,statusText:null==r?void 0:r.statusText,url:null==r?void 0:r.url,data:s})}dashboardError(e,t,r,s){this.error("Erreur Dashboard: ".concat(e),t,"Dashboard",{operation:e,filters:r,data:s})}authError(e,t,r){this.error("Erreur Auth: ".concat(e),t,"Auth",r)}getRecentLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=this.logs;return e&&(r=r.filter(t=>t.level===e)),r.slice(-t)}exportLogs(){return JSON.stringify(this.logs,null,2)}clearLogs(){this.logs=[]}getLogStats(){let e={total:this.logs.length,byLevel:{},recentErrors:this.logs.filter(e=>e.level>="ERROR").slice(-10)};return Object.values(s).forEach(t=>{e.byLevel[t]=this.logs.filter(e=>e.level===t).length}),e}constructor(){this.logs=[],this.maxLogs=1e3,this.isDevelopment=!1}}let a=new o,n=(e,t,r)=>a.info(e,t,r),c=(e,t,r)=>a.warn(e,t,r),i=(e,t,r,s)=>a.error(e,t,r,s);var l=r(94089);let d={BASE_URL:"http://localhost:5000",NODE_ENV:"production",APP_NAME:l.env.NEXT_PUBLIC_APP_NAME||"BMS",APP_VERSION:l.env.NEXT_PUBLIC_APP_VERSION||"1.0.0",REQUEST_TIMEOUT:1e4,MAX_RETRIES:3,RETRY_DELAY:1e3}.BASE_URL;n("Configuration: NEXT_PUBLIC_API_URL=".concat("http://localhost:5000"),"API"),n("URL de base utilis\xe9e: ".concat(d),"API");let u=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(d).concat(e),s=localStorage.getItem("token");n("Appel vers: ".concat(r),"API"),n("Token pr\xe9sent: ".concat(s?"OUI":"NON"),"API"),s&&(n("Token (premiers caract\xe8res): ".concat(s.substring(0,20),"..."),"API"),n("Longueur du token: ".concat(s.length),"API"));let o={headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)},...t.headers},...t};try{let t;n("Envoi de la requ\xeate vers: ".concat(r),"API");let s=await fetch(r,o);if(n("R\xe9ponse re\xe7ue: ".concat(s.status," ").concat(s.statusText),"API"),n("Headers de r\xe9ponse: ".concat(JSON.stringify(Object.fromEntries(s.headers.entries()))),"API"),!s.ok){let t={};try{t=await s.json()}catch(e){c("Impossible de parser le body d'erreur: ".concat(e instanceof Error?e.message:String(e)),"API"),t={error:"Erreur HTTP ".concat(s.status,": ").concat(s.statusText)}}if(a.apiError(e,Error("HTTP ".concat(s.status,": ").concat(s.statusText)),s,{status:s.status,statusText:s.statusText,url:r,errorData:t,headers:Object.fromEntries(s.headers.entries())}),401===s.status)throw a.authError("Token invalide",Error(t.error||"Token expir\xe9 ou invalide"),t),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("userRole"),n("Token invalide supprim\xe9 du localStorage","API"),"/login"!==window.location.pathname&&(n("Redirection vers /login","API"),window.location.href="/login"),Error("Token invalide - Redirection vers la connexion");let o=t.error||t.message||"Erreur HTTP ".concat(s.status,": ").concat(s.statusText);throw Error(o)}try{t=await s.json(),n("Succ\xe8s: ".concat(e),"API",t)}catch(e){throw i("Erreur lors du parsing de la r\xe9ponse: ".concat(e instanceof Error?e.message:String(e)),e instanceof Error?e:Error(String(e)),"API"),Error("Erreur lors du parsing de la r\xe9ponse: ".concat(e instanceof Error?e.message:String(e)))}return t}catch(s){if(a.apiError(e,s instanceof Error?s:Error(String(s)),void 0,{url:r,timestamp:new Date().toISOString()}),(s instanceof Error?s.message:String(s))==="Token invalide - Redirection vers la connexion")throw s;let t="Erreur lors de la r\xe9cup\xe9ration des donn\xe9es: ".concat(s instanceof Error?s.message:String(s));throw e.includes("/performance/")&&(t="Impossible de charger les donn\xe9es de performance. V\xe9rifiez votre connexion et r\xe9essayez."),i("Message d'erreur am\xe9lior\xe9: ".concat(t),s instanceof Error?s:Error(String(s)),"API"),Error(t)}},g={login:async e=>u("/api/auth/login",{method:"POST",body:JSON.stringify(e)}),logout:async()=>(localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("userRole"),{success:!0,message:"D\xe9connexion r\xe9ussie"}),register:async e=>u("/api/auth/register",{method:"POST",body:JSON.stringify(e)}),verifyToken:async()=>u("/api/auth/verify")},m={getAll:async()=>u("/api/offres"),create:async e=>u("/api/offres",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>u("/api/offres/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>u("/api/offres/".concat(e),{method:"DELETE"}),validate:async(e,t)=>u("/api/offres/".concat(e,"/validate"),{method:"PATCH",body:JSON.stringify(t)})},h={getOverview:async(e,t)=>{let r=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/overview".concat(r))},getPoles:async(e,t)=>{let r=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/poles".concat(r))},getPolesDetailed:async(e,t)=>{let r=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/poles-detailed".concat(r))},getTrends:async()=>u("/api/performance/trends"),getCommerciaux:async(e,t)=>{let r=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/commerciaux".concat(r))},getMetrics:async()=>u("/api/performance/metrics")},p={getAll:async e=>u("/api/scheduled-searches?userId=".concat(e)),getOptions:async()=>u("/api/scheduled-searches/options"),create:async e=>u("/api/scheduled-searches",{method:"POST",body:JSON.stringify(e)}),update:async e=>u("/api/scheduled-searches",{method:"PUT",body:JSON.stringify(e)}),delete:async e=>u("/api/scheduled-searches",{method:"DELETE",body:JSON.stringify(e)}),getSavedKeywords:async e=>u("/api/scheduled-searches/saved-keywords?userId=".concat(e)),saveKeywords:async e=>u("/api/scheduled-searches/saved-keywords",{method:"POST",body:JSON.stringify(e)}),deleteSavedKeywords:async(e,t)=>u("/api/scheduled-searches/saved-keywords/".concat(e),{method:"DELETE",body:JSON.stringify({userId:t})}),getSearchStats:async e=>u("/api/scheduled-searches/search-stats".concat(e?"?userId=".concat(e):""))}}},e=>{var t=t=>e(e.s=t);e.O(0,[654,255,347,870,358],()=>t(42608)),_N_E=e.O()}]);