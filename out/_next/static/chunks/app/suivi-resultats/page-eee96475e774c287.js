(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{150:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var r=s(73365),a=s(59534),l=s.n(a);function i(e){let{className:t="",variant:s="default",size:a="md"}=e,i="".concat("inline-flex items-center gap-2 font-medium transition-all duration-200 hover:scale-105"," ").concat({default:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow-sm hover:shadow-md",outline:"border-2 border-blue-600 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-600 hover:text-white",icon:"bg-blue-100 text-blue-600 p-2 rounded-lg hover:bg-blue-200"}[s]," ").concat({sm:"text-sm px-3 py-1.5",md:"text-base px-4 py-2",lg:"text-lg px-6 py-3"}[a]," ").concat(t);return(0,r.jsxs)(l(),{href:"/",className:i,children:[(0,r.jsx)("i",{className:"ri-home-line"}),"icon"!==s&&(0,r.jsx)("span",{children:"Accueil"})]})}},6611:(e,t,s)=>{Promise.resolve().then(s.bind(s,11064))},11064:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(73365),a=s(1521),l=s(50627),i=s(59534),n=s.n(i),o=s(150),c=s(84857),d=s(98809),u=s(63925);function m(){return(0,r.jsx)(c.default,{children:(0,r.jsx)(x,{})})}function x(){let[e,t]=(0,a.useState)(!1),[s,i]=(0,a.useState)([]),[c,m]=(0,a.useState)([]),[x,g]=(0,a.useState)(!0),[h,p]=(0,a.useState)("tous"),[f,b]=(0,a.useState)(""),[v,y]=(0,a.useState)("table"),[j,N]=(0,a.useState)(!1),[w,E]=(0,a.useState)(null),[D,S]=(0,a.useState)({dateDepotPrevu:"",dateDepotEffective:"",resultatOffre:"En cours",commentaireResultat:"",note:"",dateReceptionMontageAdministratif:"",heureReception:"",heureDepotPrevu:"",heureDepotEffective:""}),[P,R]=(0,a.useState)("tous"),[T,O]=(0,a.useState)(""),[k,A]=(0,a.useState)(""),[I,C]=(0,a.useState)(!1),[L,M]=(0,a.useState)(""),[_,U]=(0,a.useState)(!1),J=(0,l.useRouter)(),H=["P\xf4le sant\xe9","P\xf4le Wash","P\xf4le Education","P\xf4le Climat","P\xf4le Enqu\xeates","P\xf4le Mod\xe9lisation","P\xf4le Finances Publiques","P\xf4le D\xe9centralisation","P\xf4le Coh\xe9sion sociale","P\xf4le Anglophone","P\xf4le SIDIA"];(0,a.useEffect)(()=>{if(localStorage.getItem("token")){t(!0),B();let e=JSON.parse(localStorage.getItem("user")||"{}").role||"";M(e),U("s_admin"===e||"cma"===e)}else J.push("/login")},[J]);let B=async()=>{g(!0);try{let e=await u.sF.getAll();if(e.success&&e.data)i(e.data),F(e.data);else throw Error(e.error||"Erreur lors du chargement des offres")}catch(e){console.error("Erreur lors du chargement des offres:",e)}finally{g(!1)}},F=e=>{m(H.map(t=>{let s=e.filter(e=>e.poleLead===t),r=s.length,a=s.filter(e=>e.offreDeposee).length,l=s.filter(e=>"Gagn\xe9e"===e.resultatOffre).length,i=s.filter(e=>"Perdue"===e.resultatOffre).length,n=s.filter(e=>"En cours"===e.resultatOffre||!e.resultatOffre).length,o=a>0?Math.round(l/a*100):0;return{pole:t,montagees:r,deposees:a,gagnees:l,perdues:i,enCours:n,tauxReussite:o}}))},G=[...s].sort((e,t)=>{let s=e.dateDepot?new Date(e.dateDepot).getTime():e.dateDepotEffective?new Date(e.dateDepotEffective).getTime():e.dateDepotPrevu?new Date(e.dateDepotPrevu).getTime():0;return(t.dateDepot?new Date(t.dateDepot).getTime():t.dateDepotEffective?new Date(t.dateDepotEffective).getTime():t.dateDepotPrevu?new Date(t.dateDepotPrevu).getTime():0)-s}).filter(e=>{var t,s,r;let a="tous"===h||e.poleLead===h,l=!f||(null==(t=e.intituleOffre)?void 0:t.toLowerCase().includes(f.toLowerCase()))||(null==(s=e.bailleur)?void 0:s.toLowerCase().includes(f.toLowerCase()))||(null==(r=e.poleLead)?void 0:r.toLowerCase().includes(f.toLowerCase())),i=!0;if("tous"!==P){let t=e.dateDepot||e.dateDepotEffective||e.dateDepotPrevu;if(t){let e=new Date(t),s=new Date;switch(P){case"7j":i=e>=new Date(s.getTime()-6048e5);break;case"30j":i=e>=new Date(s.getTime()-2592e6);break;case"90j":i=e>=new Date(s.getTime()-7776e6);break;case"personnalise":if(T&&k){let t=new Date(T),s=new Date(k);i=e>=t&&e<=s}}}}return a&&l&&i}),z=e=>{if(!e)return"Non sp\xe9cifi\xe9e";try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(e){return"Date invalide"}},q=e=>{switch(e){case"Gagn\xe9e":return"bg-green-100 text-green-800";case"Perdue":return"bg-red-100 text-red-800";case"En cours":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},V=e=>{E(e),S({dateDepotPrevu:e.dateDepotPrevu||"",dateDepotEffective:e.dateDepotEffective||"",resultatOffre:e.resultatOffre||"En cours",commentaireResultat:e.commentaireResultat||"",note:e.note||"",dateReceptionMontageAdministratif:e.dateReceptionMontageAdministratif||"",heureReception:e.heureReception||"",heureDepotPrevu:e.heureDepotPrevu||"",heureDepotEffective:e.heureDepotEffective||""}),N(!0)},W=async()=>{if(w&&_)try{let e=await u.sF.update(w.id,D);if(e.success){let e=s.map(e=>e.id===w.id?{...e,...D,offreDeposee:!!D.dateDepotEffective||e.offreDeposee}:e);i(e),F(e),N(!1),E(null)}else console.error("Erreur lors de la sauvegarde de l'offre:",e.error)}catch(e){console.error("Erreur lors de la sauvegarde de l'offre:",e)}},X=e=>{R(e),C("personnalise"===e)};return e?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(d.A,{}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 py-12",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"text-center text-white",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-500/30 backdrop-blur-sm rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("i",{className:"ri-bar-chart-line text-2xl"})}),(0,r.jsx)("h1",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Suivi des R\xe9sultats"}),(0,r.jsx)("p",{className:"text-xl opacity-90",children:"Analyse des performances et des r\xe9sultats obtenus par p\xf4le"})]})})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-blue-100 p-6 mb-8",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Statistiques par P\xf4le"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:c.map(e=>(0,r.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200",children:[(0,r.jsx)("h3",{className:"font-bold text-blue-900 mb-4 text-center",children:e.pole}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Mont\xe9es:"}),(0,r.jsx)("span",{className:"font-semibold text-blue-600",children:e.montagees})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"D\xe9pos\xe9es:"}),(0,r.jsx)("span",{className:"font-semibold text-green-600",children:e.deposees})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Gagn\xe9es:"}),(0,r.jsx)("span",{className:"font-semibold text-green-700",children:e.gagnees})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Perdues:"}),(0,r.jsx)("span",{className:"font-semibold text-red-600",children:e.perdues})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"En cours:"}),(0,r.jsx)("span",{className:"font-semibold text-yellow-600",children:e.enCours})]}),(0,r.jsx)("div",{className:"pt-2 border-t border-blue-200",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Taux de r\xe9ussite:"}),(0,r.jsxs)("span",{className:"font-bold text-lg ".concat(e.tauxReussite>=70?"text-green-600":e.tauxReussite>=50?"text-yellow-600":"text-red-600"),children:[e.tauxReussite,"%"]})]})})]})]},e.pole))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-blue-100 p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrer par p\xf4le"}),(0,r.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"tous",children:"Tous les p\xf4les"}),H.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"P\xe9riode"}),(0,r.jsxs)("select",{value:P,onChange:e=>X(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"tous",children:"Toutes les p\xe9riodes"}),(0,r.jsx)("option",{value:"7j",children:"7 derniers jours"}),(0,r.jsx)("option",{value:"30j",children:"30 derniers jours"}),(0,r.jsx)("option",{value:"90j",children:"90 derniers jours"}),(0,r.jsx)("option",{value:"personnalise",children:"P\xe9riode personnalis\xe9e"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rechercher"}),(0,r.jsx)("input",{type:"text",placeholder:"Rechercher une offre...",value:f,onChange:e=>b(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600 mr-2",children:"Vue :"}),(0,r.jsxs)("button",{onClick:()=>y("table"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("table"===v?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)("i",{className:"ri-table-line mr-2"}),"Tableau"]}),(0,r.jsxs)("button",{onClick:()=>y("cards"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("cards"===v?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)("i",{className:"ri-grid-line mr-2"}),"Cartes"]})]})]}),I&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 items-end",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date de d\xe9but"}),(0,r.jsx)("input",{type:"date",value:T,onChange:e=>O(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date de fin"}),(0,r.jsx)("input",{type:"date",value:k,onChange:e=>A(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:T&&k&&(0,r.jsxs)("span",{children:["P\xe9riode s\xe9lectionn\xe9e : ",z(T)," - ",z(k)]})})]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-blue-100 overflow-hidden",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Tableau R\xe9sum\xe9 des Offres"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"D\xe9tails des offres avec leurs r\xe9sultats et commentaires"})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:_?(0,r.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,r.jsx)("i",{className:"ri-edit-line mr-1"}),"Mode \xe9dition activ\xe9"]}):(0,r.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,r.jsx)("i",{className:"ri-eye-line mr-1"}),"Mode consultation"]})})]})}),x?(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Chargement des donn\xe9es..."})]}):"table"===v?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Offre"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"P\xf4le Lead"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"R\xe9ception MA"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"D\xe9p\xf4t Pr\xe9vu"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"D\xe9p\xf4t Effectif"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"R\xe9sultat"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commentaire"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Note"}),_&&(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:G.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.intituleOffre||e.titre||"Sans titre"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.bailleur})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"text-sm text-gray-900",children:e.poleLead||"Non assign\xe9"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm text-gray-900",children:[(0,r.jsx)("div",{children:z(e.dateReceptionMontageAdministratif)}),e.heureReception&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.heureReception})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm text-gray-900",children:[(0,r.jsx)("div",{children:z(e.dateDepotPrevu)}),e.heureDepotPrevu&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.heureDepotPrevu})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm text-gray-900",children:[(0,r.jsx)("div",{children:z(e.dateDepotEffective)}),e.heureDepotEffective&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.heureDepotEffective})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(q(e.resultatOffre||"En cours")),children:e.resultatOffre||"En cours"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.commentaireResultat||"-"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.note||"-"})}),_&&(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)("button",{onClick:()=>V(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:[(0,r.jsx)("i",{className:"ri-edit-line mr-1"}),"Modifier"]})})]},e.id))})]})}):(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G.map(e=>(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-2",children:e.intituleOffre||e.titre||"Sans titre"}),(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(q(e.resultatOffre||"En cours")),children:e.resultatOffre||"En cours"})]}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"Bailleur:"}),(0,r.jsx)("span",{className:"text-gray-900 ml-2",children:e.bailleur||"Non sp\xe9cifi\xe9"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"P\xf4le Lead:"}),(0,r.jsx)("span",{className:"text-gray-900 ml-2",children:e.poleLead||"Non assign\xe9"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"R\xe9ception MA:"}),(0,r.jsxs)("div",{className:"text-gray-900 ml-2",children:[(0,r.jsx)("div",{children:z(e.dateReceptionMontageAdministratif)}),e.heureReception&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.heureReception})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"D\xe9p\xf4t pr\xe9vu:"}),(0,r.jsxs)("div",{className:"text-gray-900 ml-2",children:[(0,r.jsx)("div",{children:z(e.dateDepotPrevu)}),e.heureDepotPrevu&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.heureDepotPrevu})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"D\xe9p\xf4t effectif:"}),(0,r.jsxs)("div",{className:"text-gray-900 ml-2",children:[(0,r.jsx)("div",{children:z(e.dateDepotEffective)}),e.heureDepotEffective&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.heureDepotEffective})]})]}),e.commentaireResultat&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"Commentaire:"}),(0,r.jsx)("p",{className:"text-gray-900 mt-1 text-xs",children:e.commentaireResultat})]}),e.note&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"Note:"}),(0,r.jsx)("p",{className:"text-gray-900 mt-1 text-xs",children:e.note})]})]}),_&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,r.jsxs)("button",{onClick:()=>V(e),className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[(0,r.jsx)("i",{className:"ri-edit-line mr-2"}),"Modifier"]})})]},e.id))})})]}),(0,r.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,r.jsx)(o.default,{}),(0,r.jsx)(n(),{href:"/dashboard",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"Retour au Dashboard"})]})]}),j&&w&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Modifier le suivi de l'offre"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:w.intituleOffre||w.titre})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,r.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Suivi Administratif"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date de r\xe9ception pour montage administratif"}),(0,r.jsx)("input",{type:"date",value:D.dateReceptionMontageAdministratif,onChange:e=>S({...D,dateReceptionMontageAdministratif:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Heure de r\xe9ception"}),(0,r.jsx)("input",{type:"time",value:D.heureReception,onChange:e=>S({...D,heureReception:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,r.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,r.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"D\xe9p\xf4t"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date de d\xe9p\xf4t pr\xe9vu"}),(0,r.jsx)("input",{type:"date",value:D.dateDepotPrevu,onChange:e=>S({...D,dateDepotPrevu:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date de d\xe9p\xf4t effectif"}),(0,r.jsx)("input",{type:"date",value:D.dateDepotEffective,onChange:e=>S({...D,dateDepotEffective:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Heure de d\xe9p\xf4t pr\xe9vu"}),(0,r.jsx)("input",{type:"time",value:D.heureDepotPrevu,onChange:e=>S({...D,heureDepotPrevu:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Heure de d\xe9p\xf4t effective"}),(0,r.jsx)("input",{type:"time",value:D.heureDepotEffective,onChange:e=>S({...D,heureDepotEffective:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,r.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,r.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"R\xe9sultats"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"R\xe9sultat de l'offre"}),(0,r.jsxs)("select",{value:D.resultatOffre,onChange:e=>S({...D,resultatOffre:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"En cours",children:"En cours"}),(0,r.jsx)("option",{value:"Gagn\xe9e",children:"Gagn\xe9e"}),(0,r.jsx)("option",{value:"Perdue",children:"Perdue"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commentaire sur le r\xe9sultat"}),(0,r.jsx)("textarea",{value:D.commentaireResultat,onChange:e=>S({...D,commentaireResultat:e.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Commentaire sur le r\xe9sultat de l'offre..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note g\xe9n\xe9rale"}),(0,r.jsx)("textarea",{value:D.note,onChange:e=>S({...D,note:e.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Note g\xe9n\xe9rale sur l'offre..."})]})]})]})]}),(0,r.jsxs)("div",{className:"p-6 border-t border-gray-200 flex gap-4 justify-end",children:[(0,r.jsx)("button",{onClick:()=>N(!1),className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Annuler"}),(0,r.jsx)("button",{onClick:W,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Sauvegarder"})]})]})})]}):null}},63925:(e,t,s)=>{"use strict";s.d(t,{H2:()=>u,R2:()=>m,sF:()=>x,dR:()=>g,c9:()=>h});var r=function(e){return e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.CRITICAL="CRITICAL",e}({});class a{formatMessage(e){let t=new Date(e.timestamp).toLocaleTimeString(),s=e.context?"[".concat(e.context,"]"):"",r="[".concat(e.level,"]"),a="".concat(t," ").concat(r," ").concat(s," ").concat(e.message);return e.data&&(a+=" | Data: ".concat(JSON.stringify(e.data))),e.error&&(a+=" | Error: ".concat(e.error.message),e.error.stack&&(a+=" | Stack: ".concat(e.error.stack))),a}addLog(e){if(this.logs.push(e),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.isDevelopment){let t=this.formatMessage(e);switch(e.level){case"DEBUG":console.debug(t);break;case"INFO":console.info(t);break;case"WARN":console.warn(t);break;case"ERROR":case"CRITICAL":console.error(t)}}!this.isDevelopment&&e.level>="ERROR"&&this.sendToMonitoring(e)}async sendToMonitoring(e){try{{let t=JSON.parse(localStorage.getItem("bms_monitoring_logs")||"[]");t.push(e),localStorage.setItem("bms_monitoring_logs",JSON.stringify(t.slice(-100)))}}catch(e){console.error("Erreur lors de l'envoi au monitoring:",e)}}debug(e,t,s){this.addLog({level:"DEBUG",message:e,context:t,data:s,timestamp:new Date().toISOString()})}info(e,t,s){this.addLog({level:"INFO",message:e,context:t,data:s,timestamp:new Date().toISOString()})}warn(e,t,s){this.addLog({level:"WARN",message:e,context:t,data:s,timestamp:new Date().toISOString()})}error(e,t,s,r){this.addLog({level:"ERROR",message:e,error:t,context:s,data:r,timestamp:new Date().toISOString()})}critical(e,t,s,r){this.addLog({level:"CRITICAL",message:e,error:t,context:s,data:r,timestamp:new Date().toISOString()})}apiError(e,t,s,r){this.error("Erreur API sur ".concat(e),t,"API",{endpoint:e,status:null==s?void 0:s.status,statusText:null==s?void 0:s.statusText,url:null==s?void 0:s.url,data:r})}dashboardError(e,t,s,r){this.error("Erreur Dashboard: ".concat(e),t,"Dashboard",{operation:e,filters:s,data:r})}authError(e,t,s){this.error("Erreur Auth: ".concat(e),t,"Auth",s)}getRecentLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=this.logs;return e&&(s=s.filter(t=>t.level===e)),s.slice(-t)}exportLogs(){return JSON.stringify(this.logs,null,2)}clearLogs(){this.logs=[]}getLogStats(){let e={total:this.logs.length,byLevel:{},recentErrors:this.logs.filter(e=>e.level>="ERROR").slice(-10)};return Object.values(r).forEach(t=>{e.byLevel[t]=this.logs.filter(e=>e.level===t).length}),e}constructor(){this.logs=[],this.maxLogs=1e3,this.isDevelopment=!1}}let l=new a,i=(e,t,s)=>l.info(e,t,s),n=(e,t,s)=>l.warn(e,t,s),o=(e,t,s,r)=>l.error(e,t,s,r);var c=s(94089);let d={BASE_URL:"http://localhost:5000",NODE_ENV:"production",APP_NAME:c.env.NEXT_PUBLIC_APP_NAME||"BMS",APP_VERSION:c.env.NEXT_PUBLIC_APP_VERSION||"1.0.0",REQUEST_TIMEOUT:1e4,MAX_RETRIES:3,RETRY_DELAY:1e3}.BASE_URL;i("Configuration: NEXT_PUBLIC_API_URL=".concat("http://localhost:5000"),"API"),i("URL de base utilis\xe9e: ".concat(d),"API");let u=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(d).concat(e),r=localStorage.getItem("token");i("Appel vers: ".concat(s),"API"),i("Token pr\xe9sent: ".concat(r?"OUI":"NON"),"API"),r&&(i("Token (premiers caract\xe8res): ".concat(r.substring(0,20),"..."),"API"),i("Longueur du token: ".concat(r.length),"API"));let a={headers:{"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)},...t.headers},...t};try{let t;i("Envoi de la requ\xeate vers: ".concat(s),"API");let r=await fetch(s,a);if(i("R\xe9ponse re\xe7ue: ".concat(r.status," ").concat(r.statusText),"API"),i("Headers de r\xe9ponse: ".concat(JSON.stringify(Object.fromEntries(r.headers.entries()))),"API"),!r.ok){let t={};try{t=await r.json()}catch(e){n("Impossible de parser le body d'erreur: ".concat(e instanceof Error?e.message:String(e)),"API"),t={error:"Erreur HTTP ".concat(r.status,": ").concat(r.statusText)}}if(l.apiError(e,Error("HTTP ".concat(r.status,": ").concat(r.statusText)),r,{status:r.status,statusText:r.statusText,url:s,errorData:t,headers:Object.fromEntries(r.headers.entries())}),401===r.status)throw l.authError("Token invalide",Error(t.error||"Token expir\xe9 ou invalide"),t),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("userRole"),i("Token invalide supprim\xe9 du localStorage","API"),"/login"!==window.location.pathname&&(i("Redirection vers /login","API"),window.location.href="/login"),Error("Token invalide - Redirection vers la connexion");let a=t.error||t.message||"Erreur HTTP ".concat(r.status,": ").concat(r.statusText);throw Error(a)}try{t=await r.json(),i("Succ\xe8s: ".concat(e),"API",t)}catch(e){throw o("Erreur lors du parsing de la r\xe9ponse: ".concat(e instanceof Error?e.message:String(e)),e instanceof Error?e:Error(String(e)),"API"),Error("Erreur lors du parsing de la r\xe9ponse: ".concat(e instanceof Error?e.message:String(e)))}return t}catch(r){if(l.apiError(e,r instanceof Error?r:Error(String(r)),void 0,{url:s,timestamp:new Date().toISOString()}),(r instanceof Error?r.message:String(r))==="Token invalide - Redirection vers la connexion")throw r;let t="Erreur lors de la r\xe9cup\xe9ration des donn\xe9es: ".concat(r instanceof Error?r.message:String(r));throw e.includes("/performance/")&&(t="Impossible de charger les donn\xe9es de performance. V\xe9rifiez votre connexion et r\xe9essayez."),o("Message d'erreur am\xe9lior\xe9: ".concat(t),r instanceof Error?r:Error(String(r)),"API"),Error(t)}},m={login:async e=>u("/api/auth/login",{method:"POST",body:JSON.stringify(e)}),logout:async()=>(localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("userRole"),{success:!0,message:"D\xe9connexion r\xe9ussie"}),register:async e=>u("/api/auth/register",{method:"POST",body:JSON.stringify(e)}),verifyToken:async()=>u("/api/auth/verify")},x={getAll:async()=>u("/api/offres"),create:async e=>u("/api/offres",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>u("/api/offres/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>u("/api/offres/".concat(e),{method:"DELETE"}),validate:async(e,t)=>u("/api/offres/".concat(e,"/validate"),{method:"PATCH",body:JSON.stringify(t)})},g={getOverview:async(e,t)=>{let s=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/overview".concat(s))},getPoles:async(e,t)=>{let s=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/poles".concat(s))},getPolesDetailed:async(e,t)=>{let s=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/poles-detailed".concat(s))},getTrends:async()=>u("/api/performance/trends"),getCommerciaux:async(e,t)=>{let s=e&&t?"?startDate=".concat(e,"&endDate=").concat(t):"";return u("/api/performance/commerciaux".concat(s))},getMetrics:async()=>u("/api/performance/metrics")},h={getAll:async e=>u("/api/scheduled-searches?userId=".concat(e)),getOptions:async()=>u("/api/scheduled-searches/options"),create:async e=>u("/api/scheduled-searches",{method:"POST",body:JSON.stringify(e)}),update:async e=>u("/api/scheduled-searches",{method:"PUT",body:JSON.stringify(e)}),delete:async e=>u("/api/scheduled-searches",{method:"DELETE",body:JSON.stringify(e)}),getSavedKeywords:async e=>u("/api/scheduled-searches/saved-keywords?userId=".concat(e)),saveKeywords:async e=>u("/api/scheduled-searches/saved-keywords",{method:"POST",body:JSON.stringify(e)}),deleteSavedKeywords:async(e,t)=>u("/api/scheduled-searches/saved-keywords/".concat(e),{method:"DELETE",body:JSON.stringify({userId:t})}),getSearchStats:async e=>u("/api/scheduled-searches/search-stats".concat(e?"?userId=".concat(e):""))}},84857:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var r=s(73365),a=s(49458),l=s(98809);function i(e){let{children:t}=e;return(0,r.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,r.jsx)(a.A,{}),(0,r.jsxs)("main",{className:"flex-1 overflow-auto md:ml-72 transition-all duration-300",children:[(0,r.jsx)(l.A,{}),(0,r.jsx)("div",{className:"min-h-full",children:t})]})]})}},98809:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(73365),a=s(1521),l=s(99789);let i=e=>{let{className:t=""}=e,{alerts:s,isVisible:i,toggleAlerts:n,closeAlert:o}=(0,l.Z)(),[c,d]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{d(!0)},[]),c&&i&&0!==s.length)?(0,r.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-50 ".concat(t),children:[(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)("button",{onClick:n,className:"bg-gray-800 text-white px-3 py-1 rounded-full text-xs hover:bg-gray-700 transition-colors",title:"Masquer les alertes",children:"✕"})}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-red-600 text-white p-4 shadow-lg",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-xl",children:"⚠️"}),(0,r.jsxs)("h3",{className:"font-semibold text-lg",children:["Alertes d'\xe9ch\xe9ances (",s.length,")"]})]}),(0,r.jsxs)("div",{className:"text-sm opacity-90",children:["Derni\xe8re mise \xe0 jour : ",new Date().toLocaleTimeString("fr-FR")]})]}),(0,r.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border-l-4 ".concat(e.isExpired?"bg-red-800 border-red-400 animate-pulse":e.isUrgent?"bg-red-600 border-red-300 animate-pulse":"bg-orange-600 border-orange-300"),children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)("span",{className:"font-semibold",children:e.title}),e.isUrgent&&(0,r.jsx)("span",{className:"bg-red-400 text-red-900 px-2 py-1 rounded-full text-xs font-bold",children:"URGENT"}),e.isExpired&&(0,r.jsx)("span",{className:"bg-red-400 text-red-900 px-2 py-1 rounded-full text-xs font-bold",children:"EXPIR\xc9"})]}),(0,r.jsx)("p",{className:"text-sm opacity-90 mb-1",children:e.message}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-xs",children:[(0,r.jsx)("span",{className:"font-mono bg-black/20 px-2 py-1 rounded",children:e.timeRemaining}),e.offreTitle&&(0,r.jsxs)("span",{className:"opacity-75",children:["Offre: ",e.offreTitle]})]})]}),(0,r.jsx)("button",{onClick:()=>o(e.id),className:"ml-4 text-white/80 hover:text-white transition-colors",title:"Fermer cette alerte",children:"✕"})]},e.id))})]})})]}):null}},99789:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var r=s(1521);let a={montageAlertHours:72,depotAlertHours:24,timezone:"UTC"},l=()=>{let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)(a),[i,n]=(0,r.useState)(!0),[o,c]=(0,r.useState)(!1);(0,r.useEffect)(()=>{c(!0)},[]),(0,r.useEffect)(()=>{if(!o)return;let e=localStorage.getItem("alertSettings");if(e)try{let t=JSON.parse(e);l(t)}catch(e){console.error("Erreur lors du chargement des param\xe8tres d'alerte:",e),l(a),localStorage.setItem("alertSettings",JSON.stringify(a))}else l(a),localStorage.setItem("alertSettings",JSON.stringify(a))},[o]);let d=(0,r.useCallback)(e=>{l(e),localStorage.setItem("alertSettings",JSON.stringify(e))},[]),u=(0,r.useCallback)(e=>{let t=new Date,s=e.getTime()-t.getTime();if(s<=0)return"\xc9ch\xe9ance d\xe9pass\xe9e";let r=Math.floor(s/36e5),a=Math.floor(s%36e5/6e4);if(r>24){let e=Math.floor(r/24);return"".concat(e,"j ").concat(r%24,"h ").concat(a,"m")}return"".concat(r,"h ").concat(a,"m")},[]),m=(0,r.useCallback)((e,t)=>{let s=new Date,r=(e.getTime()-s.getTime())/36e5;return r>0&&r<=t},[]),x=(0,r.useCallback)(e=>{let t=new Date;return e.getTime()<=t.getTime()},[]),g=(0,r.useCallback)(e=>{let t=new Date,s=(e.getTime()-t.getTime())/36e5;return s>0&&s<=2},[]),h=(0,r.useCallback)(()=>{if(o)try{let e=localStorage.getItem("offres");if(!e)return void t([]);let r=JSON.parse(e),a=[];r.forEach(e=>{if(e.delaiTransmissionMontageAdministratif){let t=new Date(e.delaiTransmissionMontageAdministratif);m(t,s.montageAlertHours)&&a.push({id:"montage-".concat(e.id),type:g(t)?"error":"warning",title:"Montage Administratif",message:"\xc9ch\xe9ance pour le montage administratif de l'offre \"".concat(e.intituleOffre,'"'),timeRemaining:u(t),offreId:e.id,offreTitle:e.intituleOffre,isUrgent:g(t),isExpired:x(t)})}if(e.dateDepotPrevu){let t=new Date(e.dateDepotPrevu);m(t,s.depotAlertHours)&&a.push({id:"depot-".concat(e.id),type:g(t)?"error":"warning",title:"D\xe9p\xf4t d'Offre",message:"\xc9ch\xe9ance pour le d\xe9p\xf4t de l'offre \"".concat(e.intituleOffre,'"'),timeRemaining:u(t),offreId:e.id,offreTitle:e.intituleOffre,isUrgent:g(t),isExpired:x(t)})}}),a.sort((e,t)=>e.isUrgent&&!t.isUrgent?-1:!e.isUrgent&&t.isUrgent?1:0),t(a)}catch(e){console.error("Erreur lors de la g\xe9n\xe9ration des alertes:",e),t([])}},[s,u,m,x,g,o]);(0,r.useEffect)(()=>{if(!o)return;h();let e=setInterval(()=>{h()},6e4),t=()=>{h()},s=e=>{("offres"===e.key||"alertSettings"===e.key)&&h()};return window.addEventListener("alertSettingsChanged",t),window.addEventListener("storage",s),()=>{clearInterval(e),window.removeEventListener("alertSettingsChanged",t),window.removeEventListener("storage",s)}},[h,o]);let p=(0,r.useCallback)(()=>{n(!i)},[i]);return{alerts:e,settings:s,isVisible:i,saveSettings:d,toggleAlerts:p,closeAlert:(0,r.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),generateAlerts:h}}}},e=>{var t=t=>e(e.s=t);e.O(0,[255,458,347,870,358],()=>t(6611)),_N_E=e.O()}]);